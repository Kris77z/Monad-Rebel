# Rebel Agent Mesh — Frontend Application Strategy

## 1. 文档目的

本文件定义前端产品策略，确保我们在 Hackathon 演示中同时达成两个目标：

1. **应用层可用**：用户真的愿意用（提交任务、拿结果、复用结果）。
2. **基础设施可解释**：用户/评委能看懂可信结算与可验证交付（x402 + Monad + Receipt）。

核心原则：**Application-first, Infra-provable**。

## 2. 产品定位

我们前端不是“区块链浏览器”也不是“LLM 日志面板”，而是一个可用的 Agent 应用：

- 用户来这里是为了完成任务，拿到可用内容。
- Infra 细节用于建立信任与差异化，不应压过主任务流。

一句话定位：

> 先让用户高效获得结果，再让用户一键验证结果可信。

## 3. 双层叙事框架

### 3.1 应用层（默认）

回答用户问题：

1. 我该输入什么？
2. 任务进展到哪一步？
3. 我拿到的结果是否可直接使用？

默认界面只展示：

- 目标输入
- 执行状态
- 最终结果
- 可选二次操作（复制、导出、重试）

### 3.2 Infra 层（按需展开）

回答信任问题：

1. 你怎么收费？
2. 你是否真的链上结算？
3. 交付内容是否可验证、可追溯？

通过“证明抽屉/证明面板”展示：

- x402 quote（amount / payTo / requestHash）
- txHash + monadscan 链接
- receipt（requestHash / resultHash / signature）
- receiptVerified 结果

## 4. 页面信息架构（建议）

## 4.1 主工作台（核心页面）

区域 A：任务输入区

- `goal` 输入框（支持模板）
- 执行按钮 `Run`
- 模式标签（react / scripted）

区域 B：执行状态区（面向用户）

- 状态条：`已受理 -> 已报价 -> 支付中 -> 生成中 -> 已交付`
- 当前步骤一句话解释（非技术语）

区域 C：结果区（应用价值核心）

- 结果正文
- 评分与摘要（evaluation）
- 操作：复制、导出、再生成

区域 D：可信证明抽屉（默认折叠）

- 支付证明：network / amount / txHash / explorer
- 交付证明：receipt / signature / verified
- 请求锚点：requestHash

## 4.2 过程时间线（次级，演示友好）

- 来自 `trace` 事件
- 默认显示“业务化标签”
- 支持切换“技术明细”

业务标签示例：

- 已发现可用服务
- 已确认报价
- 已发起支付
- 已收到内容
- 已完成验签

## 5. 事件到 UI 状态映射

数据源：`/run/stream`（见 `docs/frontend-streaming.md`）。

| SSE 事件 | UI 状态 | 用户文案 |
|---|---|---|
| `run_started` | 已受理 | 已开始为你规划执行路径 |
| `quote_received` | 已报价 | 已确认服务价格 |
| `payment_state: payment-required` | 等待支付 | 准备支付并开始执行 |
| `payment_state: payment-submitted` | 支付中 | 正在链上确认支付 |
| `payment_state: payment-completed` | 支付完成 | 支付成功，开始生成结果 |
| `tool_call/ tool_result` | 过程节点 | 系统正在调用能力模块 |
| `receipt_verified` | 交付验真 | 交付已通过签名验证 |
| `evaluation_completed` | 质量反馈 | 已完成结果质量评估 |
| `done` | 完成 | 结果已就绪，可直接使用 |
| `error` | 失败 | 本次执行失败，可重试 |

## 6. 视觉与交互原则

1. 默认显示“任务价值”，不是“技术细节”。
2. 技术细节始终可达，但默认折叠。
3. 每个关键技术节点都要有可复制的证据字段（txHash / requestHash / signature）。
4. 时间线避免原样堆 JSON，优先结构化卡片 + 展开明细。
5. 失败状态要同时给“用户建议”和“技术原因”。

## 7. Hackathon 演示脚本（前端口径）

1. 输入目标并启动任务（强调“可用应用入口”）。
2. 展示状态从受理到交付（强调“端到端自动化”）。
3. 打开证明抽屉（强调“链上支付 + 可验证交付”）。
4. 展示 `txHash` 与 `receiptVerified`（强调“infra 能力”）。
5. 回到结果区展示可复制内容（强调“应用价值落地”）。

## 8. 实施优先级

P0（必须）：

1. 主工作台（输入、执行、结果）
2. SSE 状态条与时间线
3. 证明抽屉（tx + receipt + verify）

P1（建议）：

1. 业务视图 / 技术视图切换
2. 历史任务列表（最近 N 次）
3. 快速重试与模板目标

P2（可选）：

1. 可视化对比（不同模型或不同目标）
2. 导出报告（含证明）

## 9. 验收标准（前端）

1. 用户在 10 秒内理解“怎么发起任务”。
2. 用户在 30 秒内完成一次运行并拿到结果。
3. 评委在 60 秒内看到并理解链上与验签证据。
4. 单次 run 可完整复盘：输入、状态、结果、证明四要素齐全。

## 10. 可视化流程图

完整闭环 Graph 见：`docs/run-flow-graph.md`
